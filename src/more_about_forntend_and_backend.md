# 附錄：更深了解前後端

註：掠過這個章節不會造成對之後的內容理解上的困難，但如果對前後端的運作方式有興趣，我們在這個章節寫了一些更深入的內容。

## 網頁是怎麽呈現在瀏覽器的

從打開網頁到關掉網頁，到底發生了什麼事？我們可以從最底層的網路一路往更上層的概念看去。

### 網路是什麼？

這是最基本的問題。我們可以從最物理的角度來看它，其實就是收發一些信號，不過這裡將不打算細談這些東西，若是有興趣可以參考OSI七層架構，其中對於網路的概念有詳盡的規範。這裡我們先定義網路就只是上傳或是下載一些資訊的媒介，並且這個媒介把很多臺電腦都串起來，所以你可以傳送一些資訊給其他電腦或是從其他電腦接收一些資訊。但這裡的「資訊」並不是檔案的意思，當然檔案也可以說是資訊，但這裡的資訊也可以只是一些地址、檔名等小小的訊息。總之，**我們定義網路就只是與其他電腦傳送或接收資訊的媒介**。

### 通訊協定(Protocol)

為了方便電腦之間溝通，通常都會定義一些規範讓電腦遵守，這個規範通常包含了溝通內容的格式，以及溝通如何開始、結束，還有當錯誤發生時要如何處理。而在網路世界中，基本上資訊的傳遞都是透過 http 這個協定來傳送的。

#### 溝通內容
規範溝通內容的格式是為了方便處理。先前提到了網路是傳送或接收資訊的媒介，而這個資訊的內容是可以很自由的。我們可以想象傳送一次資訊就像傳送一張白紙，白紙上可以隨便你怎麼寫。那麼假如你要開一家店，可以讓大家用白紙跟你訂購東西的話，你會怎麽做？這時後你一定會希望大家給你的訊息（一張寫了字的紙）都滿足某種規範，像是必需要包含訂購人的名字、地址、訂購的東西。然而其實只規範這些還是不夠的，因為你有可能會收到像是這種資訊：

```
XXX市XXX路XXX號
李子
木瓜
```

雖然猜得出來`XXX市XXX路XXX號`這一行是地址，但是究竟`李子`還是`木瓜`是訂購人呢？這時後你可能有兩種解決方法，第一個是規定第一行要填寫地址、第二行要寫訂購人的名字，另外一種則是規定地址前面必須標注地址、訂購人前面必須標注訂購人，像是這樣
```
地址：XXX市XXX路XXX號
訂購人：李子
訂購物：木瓜
```

而所謂協定其實就有一部份是在規範這種事情，並且其實還會規範更多細節，像是要用哪個符號代表換行之類的。
以 http 為例，每次傳送的訊息都會包含一個叫做「表頭」(header)的部份，而這個表頭則包含了請求主機的名稱、請求的網址等等。像是打開維基百科的表頭就長這樣
```
GET /w/api.php?page=Template%3AAdvancedSiteNotices%2Fajax&variant=zh-tw&prop=text&action=parse&format=json&maxage=3600&smaxage=3600 HTTP/1.1
Host: zh.wikipedia.org
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:47.0) Gecko/20100101 Firefox/47.0
Accept: */*
Accept-Language: en,en-US;q=0.7,zh-TW;q=0.3
Accept-Encoding: gzip, deflate, br
DNT: 1
X-Requested-With: XMLHttpRequest
Referer: https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE
Cookie: WMF-Last-Access=03-Jul-2016; TBLkisOn=0; cn_wam_201511-1=1; GeoIP=TW:03:Taipei:25.04:121.53:v4; CP=H2; zhwikimwuser-sessionId=89ead8b8ada950fe
Connection: keep-alive
```

#### 事件處理

協定還規範了一些「事件」要怎麼處理，事件包含了像是錯誤、收到等事件。規範事件處理的原因就在於，假如你今天開的是水果店，但是有人跟你訂購手機，你要如何回覆？以及，有人跟你訂購東西，你要怎麼告訴他你收到了他的訂購單？以 http 協定為例：當使用者要求一個不存在的網頁，伺服器就會回覆一個狀態碼`404`，而如果一切都順利，伺服器則是會回覆`200`。

### 請求(request)與回覆(response)

在網頁的世界裡，所有的事就都是使用者（客戶端 client）跟伺服器發送「請求」然後伺服器「回覆」請求。例如：當你打開一個網頁時，就會跟伺服器發出一個「請求」，然後伺服器就會「回覆」你，提供一個 html 檔給你下載下來。如果你要上傳一個檔案，也是發出一個請求，並把檔案附在請求裡，然後伺服器在接收完檔案之後會「回覆」你結果。
http 定義了幾種「請求」的方法（method），他們的運作方式基本上是都一樣的，但是有語意上的差別。也就是說，在慣例上，做某些事情應該要用某種「請求」。以下大概介紹兩種比較常見的「請求」方法：

#### GET

通常下載東西、打開網頁都是用這種「請求」。在語意上，這種請求不應該改變任何東西，也就是說，存在伺服器的資料不應該因為這種請求而改變。

#### POST

POST 則通常被用在提交表單或上傳東西。而這個請求在語意上就可以改變伺服器上的資料了，像是提交表單時，資料庫會出現你的提交。


### 瀏覽器在做什麼


瀏覽器的工作包含了下載網頁以及渲染(render)網頁還有執行網頁裡的程式。當滑鼠戳下一個連結時，你的瀏覽器（像是Firefox、Chrome）會去看看那個連結（網址）是對應到哪一臺伺服器，然後發出一個請求給那台伺服器。瀏覽器收到回覆後，會開始解析收到的 html 檔，假如 html 裡有引用其他資源，像是圖片或是放在別的檔案的 javascript ，瀏覽器會接著發出請求去下載那些東西。同時，如果網頁有 javascript，瀏覽器會開始執行。並且，瀏覽器還會依照 html、css 的規則，開始把網頁畫到螢幕上。

